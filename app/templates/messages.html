<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Chat MMT</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/animate.css')}}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css')}}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/line-awesome.css')}}">
	<link rel="stylesheet" type="text/css"
		href="{{ url_for('static', filename='css/line-awesome-font-awesome.min.css')}}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome.min.css"')}}'>
	<link rel=" stylesheet" type="text/css"
		href="{{ url_for('static', filename='css/jquery.mCustom mScrollbar.min.css')}}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css')}}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/responsive.css')}}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" rel="stylesheet">
	<link rel="icon" href="{{ url_for('static', filename='img/banner.png')}}">
</head>


<body>
	<header>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<!-- <form class="form-inline my-2 my-lg-0" action="/search"></form> -->
			<div class="dropdown">
				<input class="form-control mr-sm-2" type="search" placeholder="Search user name..." id="search-input"
					name="search-input" autocomplete="off">
				<div class="dropdown-menu-search" id="dropdown-menu-search"></div>
				<!-- <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button> -->
			</div>
			<!-- </form> -->
			<div class="clearfix">
				<a href="/logout" class="btn btn-info btn-sm float-xl-right pull-right">
					<span class="glyphicon glyphicon-log-out"></span> Log out
				</a>
			</div>
		</nav>
	</header>
	<div id="alert"></div>

	<div class="wrapper">

		<section class="messages-page">
			<div class="container">
				<div class="messages-sec">
					<div class="row" id="inchat">
						<div class="col-lg-4 col-md-12 no-pdd left">
							<div class="msgs-list">
								<div class="msg-title">
									<button onclick="backtoFront()">Back</button>
									<h3>Messages</h3>
								</div>
								<!--msg-title end-->
								<div class="messages-list">
									<ul>
										<li class="active">
											<div class="usr-msg-details">
												<div class="usr-ms-img">
													<a href={{ session['user'].avatar}}></a>
													<span class="msg-status"></span>
												</div>
												<div class="usr-mg-info">
													<h3>John</h3>
												</div>
											</div>
											<!--usr-msg-details end-->
										</li>
										<li>
											<div class="usr-msg-details">
												<div class="usr-ms-img">
													<img src={{ session['user'].avatar }} alt="">
													<p>Alooo</p>
												</div>
												<div class="usr-mg-info">
													<h3>David Vane</h3>
												</div>
												<!--usr-mg-info end-->
											</div>
											<!--usr-msg-details end-->
										</li>
									</ul>
								</div>
								<!--messages-list end-->
							</div>
							<!--msgs-list end-->
						</div>
						<div class="col-lg-8 col-md-12 pd-right-none pd-left-none right">
							<div class="main-conversation-box">
								<div class="messages-line" id="chat">
									<div class="message-right message">
										<p>
											abcddef
										</p>
									</div>
									<div class="message-left message">
										<p>
											abcddef
										</p>
									</div>

								</div>
								<!--messages-line end-->
								<div class="message-send-area">
									<div class="mf-field">
										<input type="text" name="message" placeholder="Type a message here" id="message"
											onkeypress="enterEV()">
										<button id="send">Send</button>
									</div>
								</div>
								<!--message-send-area end-->
							</div>
							<!--main-conversation-box end-->
						</div>
					</div>
					<div class=" row" id="frontpage">
						<div class="friend-info">
							<div class="row">
								{% for x in contactList(session['user'].name) %}
								<div class="col-lg-4">
									<div class="card-deck">
										<div class="card">
											<div class="card-body">
												<h3 class="card-title">{{ x.name }}</h3>
												<div class="usr-ms-img">
													<img src="images/resources/m-img2.png" alt="">
												</div>
												<div class="usr-mg-info">
													<img src="https://i.imgur.com/jUmCAZj.jpg" alt="" height="50">
												</div>
												<!--usr-mg-info end-->
												<a href="#" class="btn btn-primary" onclick="ask('{{x.name}}')">Chat</a>
											</div>
										</div>
									</div>
								</div>
								{% endfor %}
							</div>
						</div>
					</div>
				</div>
				<!--messages-sec end-->
			</div>
		</section>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="{{ url_for('static', filename='js/script.js')}}"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script>
		$(document).ready(function () {
			var html = "";
			var url = window.location.href;
			var myName = url.split('=')[1];
			var myUserName = myName.split('#')[0];
			$('#search-input').keyup(function () {
				if ($('#search-input').val() != "") {
					$.ajax({
						dataType: "json",
						url: "/search?search-input=" + $('#search-input').val() + "&myname=" + myUserName,
						success: function (data) {
							for (var i = 0; i < data.length; i++) {
								html += '<div class="searhUser" id="searchUser' + data[i].name + '\"><span>' + data[i].name + '</span> <button class="btn btn-outline-success my-2 my-sm-0"  id="addBtn' + data[i].name + '\" onclick=\"add(\'' + myUserName + "\',\'" + data[i].name + '\')\">Add</button></div>\n'
							}
							$('#dropdown-menu-search div').remove();
							$('dropdown-menu-search').html("");
							$("#dropdown-menu-search").append(html);
							html = "";

						}
					});
				}
				else {
					$('#dropdown-menu-search div').remove();
				}
			});
		});
		function add(myname, cname) {
			$.ajax({
				dataType: "json",
				url: "/addContact?name=" + myname + "&cname=" + cname,
				success: function (data) {
					$('div#searchUser' + data.cname).remove();
					var ale = "Bạn vừa thêm <strong>" + data.cname + "</strong> vào danh sách liên lạc!!!";
					$('#alert').html(ale);
					$('#alert').addClass("alert alert-success");
					$("#alert").delay(2000).slideUp(500, function () {
						$(this).html("");
						$(this).removeClass("alert alert-success");
						document.getElementById("alert").style.display = "block";
					});
				}
			});
		}
	</script>
</body>


</html>